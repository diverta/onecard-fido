# 詳細仕様

最終更新日：2022/10/29

## 概要
OpenPGPに関する仕様の詳細について記載しています。

## PIN番号管理

以下のPIN番号管理機能についての仕様詳細を記載しています。
- PIN番号を変更
- 管理用PIN番号を変更
- PIN番号をリセット
- リセットコードを変更
- リセットコードでPIN番号をリセット

### 実行するコマンド

PIN番号管理機能で実行するコマンドは、下記一覧の通りとなっております。<br>
（最終更新日の時点で、[nRF52840アプリケーション](../../nRF52840_app)に実装されているもの）

|#|INS|P1|P2|名称|説明|
|:---:|:---|:---|:---|:---|:---|
|1|`0x20`|`0x00`|`0x83`|Admin PIN verification|管理用PIN番号を使用し認証実行|
|2|`0x24`|`0x00`|`0x81`|Change PIN|PIN番号を変更<br>（変更前のPIN番号を使用し認証実行）|
|3|`0x24`|`0x00`|`0x83`|Change admin PIN|管理用PIN番号を変更<br>（変更前の管理用PIN番号を使用し認証実行）|
|4|`0x2C`|`0x02`|`0x81`|Reset PIN|PIN番号をリセット|
|5|`0x2C`|`0x00`|`0x81`|Reset PIN, auth with <br>resetting code|PIN番号をリセット<br>（リセットコードを使用し認証実行）|
|6|`0xCA`|`0x00`|`0xC4`|Get password status|PIN番号／管理用PIN番号／リセットコード<br>についてのリトライカウンターを取得|
|7|`0xDA`|`0x00`|`0xD3`|Change resetting code|リセットコードを変更|

### PIN番号を変更

<b>リクエストコマンド</b>

|#|INS|P1|P2|名称|説明|
|:---:|:---|:---|:---|:---|:---|
|1|`0x24`|`0x00`|`0x81`|Change PIN|PIN番号を変更<br>（変更前のPIN番号を使用し認証実行）|

<b>リクエストデータ</b>

|#|Offset|桁数|名称|説明|
|:---:|:---|:---|:---|:---|
|1|0|6|現在のPIN番号|画面入力値|
|2|6|6|新しいPIN番号|画面入力値|

<b>レスポンスステータスワード</b>

|#|値|名称|説明|
|:---:|:---|:---|:---|
|1|`0x9000`|`SW_NO_ERROR`|正常終了|
|2|`0x63Cn`|`SW_PIN_RETRIES`|認証失敗（あと`n`回試行可能）|
|3|上記以外|-|処理失敗|

### 管理用PIN番号を変更

<b>リクエストコマンド</b>

|#|INS|P1|P2|名称|説明|
|:---:|:---|:---|:---|:---|:---|
|1|`0x24`|`0x00`|`0x83`|Change admin PIN|管理用PIN番号を変更<br>（変更前の管理用PIN番号を使用し認証実行）|

<b>リクエストデータ</b>

|#|Offset|桁数|名称|説明|
|:---:|:---|:---|:---|:---|
|1|0|8|現在の管理用PIN番号|画面入力値|
|2|8|8|新しい管理用PIN番号|画面入力値|

<b>レスポンスステータスワード</b>

|#|値|名称|説明|
|:---:|:---|:---|:---|
|1|`0x9000`|`SW_NO_ERROR`|正常終了|
|2|`0x63Cn`|`SW_PIN_RETRIES`|認証失敗（あと`n`回試行可能）|
|3|上記以外|-|処理失敗|

### リセットコードを変更

#### （１）管理用PIN番号による認証

<b>リクエストコマンド</b>

|#|INS|P1|P2|名称|説明|
|:---:|:---|:---|:---|:---|:---|
|1|`0x20`|`0x00`|`0x83`|Admin PIN verification|管理用PIN番号を使用し認証実行|

<b>リクエストデータ</b>

|#|Offset|桁数|名称|説明|
|:---:|:---|:---|:---|:---|
|1|0|8|現在の管理用PIN番号|画面入力値|

<b>レスポンスステータスワード</b>

|#|値|名称|説明|
|:---:|:---|:---|:---|
|1|`0x9000`|`SW_NO_ERROR`|正常終了|
|2|`0x63Cn`|`SW_PIN_RETRIES`|認証失敗（あと`n`回試行可能）|
|3|`0x6983`|`SW_AUTHENTICATION_BLOCKED`|認証ブロック（試行不可）|
|4|上記以外|-|処理失敗|

#### （２）リセットコード変更

<b>リクエストコマンド</b>

|#|INS|P1|P2|名称|説明|
|:---:|:---|:---|:---|:---|:---|
|1|`0xDA`|`0x00`|`0xD3`|Change resetting code|リセットコードを変更|

<b>リクエストデータ</b>

|#|Offset|桁数|名称|説明|
|:---:|:---|:---|:---|:---|
|1|0|8|新しいリセットコード|画面入力値|

<b>レスポンスステータスワード</b>

|#|値|名称|説明|
|:---:|:---|:---|:---|
|1|`0x9000`|`SW_NO_ERROR`|正常終了|
|2|上記以外|-|処理失敗|
