# CCIDãƒ‰ãƒ©ã‚¤ãƒãƒ¼ä¿®æ­£ãƒ“ãƒ«ãƒ‰æ‰‹é †

æœ€çµ‚æ›´æ–°æ—¥ï¼š2023/1/16

macOSã«ãƒ—ãƒ¬ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹CCIDãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ä¿®æ­£ãƒ“ãƒ«ãƒ‰ã™ã‚‹æ‰‹é †ã«ã¤ã„ã¦æ²è¼‰ã—ã¦ã„ã¾ã™ã€‚

#### çµŒç·¯ãƒ»ç›®çš„

[MDBT50Q Dongle](../FIDO2Device/MDBT50Q_Dongle/README.md)ã¯USB-IFï¼ˆ[USB Implementers Forum, Inc.](https://www.usb.org)ï¼‰ã«å‚åŠ ãƒ»å±Šå‡ºã‚’ã—ã¦ã„ãªã„è£½é€ è€…ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã‚ã‚‹ãŸã‚ã€macOSã§CCIDãƒ‡ãƒã‚¤ã‚¹ã¨ã—ã¦èªè­˜ã•ã‚Œã¾ã›ã‚“ã€‚<br>
ã“ã®ãŸã‚ã€MDBT50Q Dongleã¯ã€macOSä¸Šã§CCIDã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹æ©Ÿèƒ½ï¼ˆPIVã€OpenPGPã€OATHï¼‰ã‚’å®Ÿè¡Œã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

ä»–æ–¹ã€MDBT50Q Dongleã¯ä»®ã®è£½é€ å…ƒIDã€Œ`0xF055`ã€ãŒä»˜ä¸ã•ã‚Œã¦ã„ã¾ã™ã€‚<br>
ï¼ˆå½“ç„¶ã§ã™ãŒã€ã“ã‚Œã¯USB-IFã®ç®¡ç†å¯¾è±¡ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰<br>
ã“ã®è£½é€ å…ƒIDã‚’ã€macOSã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹CCIDãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã§ç®¡ç†å¯¾è±¡ã¨ã•ã›ã‚‹ãŸã‚ã«ã¯ã€macOSã«ãƒ—ãƒ¬ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹CCIDãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ä¿®æ­£ãƒ“ãƒ«ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ‰‹é †ã«ã‚ˆã‚ŠCCIDãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ä¿®æ­£ãƒ“ãƒ«ãƒ‰ã—ã€ã“ã‚Œã‚’macOSã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€MDBT50Q Dongleã‚’CCIDãƒ‡ãƒã‚¤ã‚¹ã¨ã—ã¦macOSã«èªè­˜ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

#### æ³¨æ„ç‚¹

æœ¬æ‰‹é †æ›¸ã§ä½¿ç”¨ã™ã‚‹CCIDãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯ã€ãã®æ›´æ–°ã®ãŸã³ã«è¿½å¾“ä½œæ¥­ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚<br>
é©å®œã€[USB-IFã®è©²å½“ãƒšãƒ¼ã‚¸](https://ccid.apdu.fr/files/)ã§ã€æ›´æ–°æƒ…å ±ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

æœ€çµ‚æ›´æ–°æ—¥ç¾åœ¨ã®CCIDãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã€[`1.5.1`](https://salsa.debian.org/rousseau/CCID/blob/master/README.md)ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚

## ä½œæ¥­æ‰‹é †

#### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å°å…¥

ãƒ“ãƒ«ãƒ‰ä½œæ¥­ã®ãŸã‚ã«å¿…è¦ã¨ãªã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã€`brew`ãªã©ã§äº‹å‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã¾ã™ã€‚<br>
é€šå¸¸ã®macOSç’°å¢ƒã§ã¯`libusb`ãŒå°å…¥ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€è¿½åŠ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
bash-3.2$ brew install libusb
Running `brew update --preinstall`...
ï¼ˆä¸­ç•¥ï¼‰
==> Fetching libusb
==> Downloading https://ghcr.io/v2/homebrew/core/libusb/manifests/1.0.26
######################################################################## 100.0%
==> Downloading https://ghcr.io/v2/homebrew/core/libusb/blobs/sha256:72ed40aec0356157f3d5071ecb28c481b3f3502985a320ec184
==> Downloading from https://pkg-containers.githubusercontent.com/ghcr1/blobs/sha256:72ed40aec0356157f3d5071ecb28c481b3f
######################################################################## 100.0%
==> Upgrading libusb
  1.0.24 -> 1.0.26

==> Pouring libusb--1.0.26.catalina.bottle.tar.gz
ğŸº  /usr/local/Cellar/libusb/1.0.26: 22 files, 532.0KB
==> Running `brew cleanup libusb`...
ï¼ˆä¸­ç•¥ï¼‰
==> Checking for dependents of upgraded formulae...
==> No broken dependents found!
bash-3.2$
```

`libusb`ã¯ã€`/usr/local/Cellar/libusb/1.0.26/lib`ã«å°å…¥ã•ã‚Œã¾ã™ã€‚

```
bash-3.2$ ls -al /usr/local/Cellar/libusb/1.0.26/lib
total 608
drwxr-xr-x   6 makmorit  staff     192  4 10  2022 .
drwxr-xr-x  13 makmorit  staff     416  1 16 11:02 ..
-r--r--r--   1 makmorit  staff  141344  1 16 11:02 libusb-1.0.0.dylib
-r--r--r--   1 makmorit  staff  165968  4 10  2022 libusb-1.0.a
lrwxr-xr-x   1 makmorit  staff      18  4 10  2022 libusb-1.0.dylib -> libusb-1.0.0.dylib
drwxr-xr-x   3 makmorit  staff      96  1 16 11:02 pkgconfig
bash-3.2$
```

ãƒ“ãƒ«ãƒ‰ä½œæ¥­ã‚„ã€ãƒ“ãƒ«ãƒ‰å¾Œã®CCIDãƒ‰ãƒ©ã‚¤ãƒãƒ¼å®Ÿè¡Œã®éš›ã¯ã€å‹•çš„ãƒªãƒ³ã‚¯ãŒä¸è¦ã§ã‚ã‚‹ãŸã‚ã€å¿…ãš`.dylib`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªãƒãƒ¼ãƒ ã—ã¦ãŠãã‚ˆã†ã«ã—ã¾ã™ã€‚

```
bash-3.2$ cd /usr/local/Cellar/libusb/1.0.26/lib
bash-3.2$ mv libusb-1.0.0.dylib __libusb-1.0.0.dylib
bash-3.2$ mv libusb-1.0.dylib __libusb-1.0.dylib
bash-3.2$
bash-3.2$ ls -al
total 608
drwxr-xr-x   6 makmorit  staff     192  1 16 11:21 .
drwxr-xr-x  13 makmorit  staff     416  1 16 11:02 ..
-r--r--r--   1 makmorit  staff  141344  1 16 11:02 __libusb-1.0.0.dylib
lrwxr-xr-x   1 makmorit  staff      18  4 10  2022 __libusb-1.0.dylib -> libusb-1.0.0.dylib
-r--r--r--   1 makmorit  staff  165968  4 10  2022 libusb-1.0.a
drwxr-xr-x   3 makmorit  staff      96  1 16 11:02 pkgconfig
bash-3.2$
```

#### ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—

ä¸‹è¨˜ã‚µã‚¤ãƒˆã‹ã‚‰[ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼ˆ`ccid-1.5.1.tar.bz2`ï¼‰](https://ccid.apdu.fr/files/ccid-1.5.1.tar.bz2)ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
- <b>[CCID free software driver](https://ccid.apdu.fr)</b>

ã‚µã‚¤ãƒˆ[`https://ccid.apdu.fr`](https://ccid.apdu.fr)ã‚’è¡¨ç¤ºã—ã€é’ã„ã€ŒDownloadã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

<img src="assets03/0001.jpg" width="640">

é·ç§»å…ˆãƒšãƒ¼ã‚¸ã«ã‚ã‚‹ã€ŒLatest versionã€ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

<img src="assets03/0002.jpg" width="640">

ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã€Œ`ccid-1.5.1.tar.bz2`ã€ã‚’è§£å‡ã—ã¾ã™ã€‚

<img src="assets03/0003.jpg" width="480">

è§£å‡ã—ãŸãƒ•ã‚©ãƒ«ãƒ€ãƒ¼`ccid-1.5.1`ã‚’ã€`${HOME}/opt/`é…ä¸‹ã«<b>ç§»å‹•ã—ã¾ã™</b>ã€‚

```
bash-3.2$ ls -al ${HOME}/Downloads
total 1464
drwx------@  6 makmorit  staff     192  1 16 11:24 .
drwxr-xr-x+ 42 makmorit  staff    1344  1 16 09:06 ..
:
drwxr-xr-x@ 31 makmorit  staff     992 11 14 19:42 ccid-1.5.1
-rw-r--r--@  1 makmorit  staff  702586  1 16 11:23 ccid-1.5.1.tar.bz2
bash-3.2$
bash-3.2$ mv ${HOME}/Downloads/ccid-1.5.1 ${HOME}/opt
bash-3.2$
bash-3.2$ ls -al ${HOME}/opt/
total 32
drwxr-xr-x  10 makmorit  staff    320  1 16 11:25 .
drwxr-xr-x+ 42 makmorit  staff   1344  1 16 09:06 ..
:
drwxr-xr-x@ 31 makmorit  staff    992 11 14 19:42 ccid-1.5.1
:
bash-3.2$

```

#### ãƒ¡ã‚¤ã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆ

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼`ccid-1.4.32`ã«ç§»å‹•ã—ãŸã‚‰ã€ã‚·ã‚§ãƒ«`./MacOSX/configure`ã‚’å®Ÿè¡Œã—ã€ãƒ¡ã‚¤ã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```
bash-3.2$ cd ${HOME}/opt/ccid-1.5.1/
bash-3.2$ ./MacOSX/configure
+ ./configure 'CFLAGS= -DRESPONSECODE_DEFINED_IN_WINTYPES_H' PCSC_CFLAGS=-I/Users/makmorit/opt/ccid-1.5.1/MacOSX 'PCSC_LIBS=-framework PCSC' LIBUSB_CFLAGS=-I/usr/local/Cellar/libusb/1.0.26/include/libusb-1.0 'LIBUSB_LIBS=-L/usr/local/Cellar/libusb/1.0.26/lib -lusb-1.0 -lobjc -Wl,-framework,IOKit -Wl,-framework,CoreFoundation -Wl,-framework,Security' LDFLAGS= --enable-usbdropdir=/usr/local/libexec/SmartCardServices/drivers --disable-dependency-tracking --enable-oslog --disable-static --disable-pcsclite --enable-composite-as-multislot
checking for a BSD-compatible install... /usr/local/bin/ginstall -c
checking whether build environment is sane... yes
checking for a race-free mkdir -p... /usr/local/bin/gmkdir -p
ï¼ˆä¸­ç•¥ï¼‰
libccid has been configured with following options:

Version:             1.5.1
Host:                x86_64-apple-darwin19.6.0
Compiler:            gcc
Preprocessor flags:  
Compiler flags:       -DRESPONSECODE_DEFINED_IN_WINTYPES_H
ï¼ˆä¸­ç•¥ï¼‰
libusb support:          yes
composite as multislot:  yes
multi threading:         yes
bundle directory name:   ifd-ccid.bundle
USB drop directory:      /usr/local/libexec/SmartCardServices/drivers
serial Twin support:     no
serial twin install dir: /usr/local/libexec/SmartCardServices/drivers/serial
serial config directory:
compiled for pcsc-lite:  no
syslog debug:            no
os_log debug:            yes
class driver:            yes
ï¼ˆä¸­ç•¥ï¼‰
+ r=0
+ rm -f src/Info.plist
+ exit 0
bash-3.2$ echo $?
0
bash-3.2$
```

#### ã‚µãƒãƒ¼ãƒˆãƒ‡ãƒã‚¤ã‚¹ãƒªã‚¹ãƒˆã®ä¿®æ­£å†…å®¹

æ–°ãŸã«macOSã§ã‚µãƒãƒ¼ãƒˆã•ã›ãŸã„ãƒ‡ãƒã‚¤ã‚¹ã¨ãªã‚‹ã€MDBT50Q Dongleã®è£½å“IDï¼ˆVIDï¼PIDï¼‰ã‚’ã€ã‚µãƒãƒ¼ãƒˆãƒ‡ãƒã‚¤ã‚¹ãƒªã‚¹ãƒˆã«è¿½è¨˜ã—ã¾ã™ã€‚

MDBT50Q Dongleã¯ã€è£½é€ å…ƒIDï¼`0xF055`ã€è£½å“IDï¼`0x0001`ã¨ã—ã¾ã™ã€‚<br>
ã“ã®å€¤ã‚’ã€`readers/supported_readers.txt`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½è¨˜ã—ã¾ã™ã€‚<br>
è¨˜è¿°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚

```
# <è£½é€ è€…å>
<VID>:<PID>:<è£½é€ è€…å> <è£½å“å>
```

ä¸‹è¨˜ã¯è¨­å®šä¾‹ã«ãªã‚Šã¾ã™ã€‚
- è£½é€ è€…å: `Diverta Inc.`
- è£½å“å: `Secure Dongle`
- VID: `0xF055`
- PID: `0x0001`

```
# Diverta Inc.
0xF055:0x0001:Diverta Inc. Secure Dongle
```

#### ã‚µãƒãƒ¼ãƒˆãƒ‡ãƒã‚¤ã‚¹ãƒªã‚¹ãƒˆã®ä¿®æ­£ï¼ˆãƒ‘ãƒƒãƒé©ç”¨ï¼‰
å…ˆè¿°ã®ã‚µãƒãƒ¼ãƒˆãƒ‡ãƒã‚¤ã‚¹ãƒªã‚¹ãƒˆ`supported_readers.txt`ã‚’ä¿®æ­£ã™ã‚‹ãŸã‚ã®ãƒ‘ãƒƒãƒã‚’ç”¨æ„ã—ã¦ãŠã‚Šã¾ã™ã€‚<br>
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ç­‰ã‚’ä½¿ç”¨ã—ãªãã¦ã‚‚ã€ã‚µãƒãƒ¼ãƒˆãƒ‡ãƒã‚¤ã‚¹ãƒªã‚¹ãƒˆã‚’ä¿®æ­£ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```
cd ${HOME}/opt/ccid-1.5.1/
patch readers/supported_readers.txt < ${HOME}/GitHub/onecard-fido/CCID/macOSDriver/supported_readers.txt.patch
```

ä¸‹è¨˜ã¯å®Ÿè¡Œä¾‹ã«ãªã‚Šã¾ã™ã€‚

```
bash-3.2$ patch readers/supported_readers.txt < ${HOME}/GitHub/onecard-fido/CCID/macOSDriver/supported_readers.txt.patch
patching file readers/supported_readers.txt
Hunk #1 succeeded at 926 with fuzz 2 (offset 134 lines).
bash-3.2$
bash-3.2$ cat readers/supported_readers.txt | grep Diverta
# Diverta Inc.
0xF055:0x0001:Diverta Inc. Secure Dongle
bash-3.2$
```

#### ãƒ“ãƒ«ãƒ‰ã®å®Ÿè¡Œ

`make`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
bash-3.2$ make
/Applications/Xcode.app/Contents/Developer/usr/bin/make  all-recursive
Making all in readers
make[2]: Nothing to be done for `all'.
ï¼ˆä¸­ç•¥ï¼‰
make[3]: Nothing to be done for `all-am'.
Making all in src
  CC       parse-parse.o
  CC       parse-debug.o
  CC       parse-ccid_usb.o
ï¼ˆä¸­ç•¥ï¼‰
  CCLD     libccid.la
make[2]: Nothing to be done for `all-am'.
bash-3.2$
bash-3.2$ echo $?
0
bash-3.2$
```

ä»¥ä¸Šã§ãƒ“ãƒ«ãƒ‰ã¯å®Œäº†ã«ãªã‚Šã¾ã™ã€‚

#### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å®Ÿè¡Œ

å‹•ä½œç¢ºèªã‚’è¡Œã†ãŸã‚ã€ã‚³ãƒãƒ³ãƒ‰`sudo make install`ã‚’ä½¿ç”¨ã—ã€ãƒ“ãƒ«ãƒ‰ã—ãŸCCIDãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ã‚·ã‚¹ãƒ†ãƒ ï¼ˆmacOSï¼‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
bash-3.2$ sudo make install
Password:
Making install in readers
make[2]: Nothing to be done for `install-exec-am'.
make[2]: Nothing to be done for `install-data-am'.
ï¼ˆä¸­ç•¥ï¼‰
Making install in src
./create_Info_plist.pl ./../readers/supported_readers.txt ./Info.plist.src --target=libccid.dylib --version=1.5.1  > Info.plist
/bin/sh /Users/makmorit/opt/ccid-1.5.1/install-sh -d "/usr/local/libexec/SmartCardServices/drivers/ifd-ccid.bundle/Contents/MacOS/"
cp Info.plist "/usr/local/libexec/SmartCardServices/drivers/ifd-ccid.bundle/Contents/"
cp .libs/libccid.dylib "/usr/local/libexec/SmartCardServices/drivers/ifd-ccid.bundle/Contents/MacOS/libccid.dylib"
***************
copy the src/92_pcscd_ccid.rules file in udev directory (/etc/udev/rules.d/)
***************
make[2]: Nothing to be done for `install-exec-am'.
make[2]: Nothing to be done for `install-data-am'.
bash-3.2$
bash-3.2$ echo $?
0
bash-3.2$
```

ã“ã®ä½œæ¥­ã‚’ãŠã“ãªã£ã¦ã‚‚ã€macOSã«ãƒ—ãƒ¬ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸCCIDãƒ‰ãƒ©ã‚¤ãƒãƒ¼`/usr/libexec/SmartCardServices`ã¯ã€ä¸Šæ›¸ãä¿®æ­£ã•ã‚Œã¾ã›ã‚“ã€‚<br>
æœ¬ä»¶ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Ÿè¡Œã§ã¯ã€`/usr/local/libexec/SmartCardServices`ã¨ã„ã†å ´æ‰€ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸCCIDãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥å‚ç…§ã—ã€æ–°ãŸã«è¿½åŠ ã—ãŸã‚µãƒãƒ¼ãƒˆå¯¾è±¡ãƒ‡ãƒã‚¤ã‚¹ãŒã€ã‚µãƒãƒ¼ãƒˆãƒ‡ãƒã‚¤ã‚¹ãƒªã‚¹ãƒˆã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç‚ºå¿µç¢ºèªã—ã¾ã™ã€‚

```
bash-3.2$ cd /usr/local/libexec/SmartCardServices/drivers/ifd-ccid.bundle/Contents/
bash-3.2$ cat Info.plist | grep Diverta
		<string>Diverta Inc. Secure Dongle</string>
bash-3.2$
```

ä»¥ä¸Šã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯å®Œäº†ã«ãªã‚Šã¾ã™ã€‚

#### å‹•ä½œç¢ºèª

PCã‚’å†èµ·å‹•ã—ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸCCIDãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’æœ‰åŠ¹åŒ–ã•ã›ã¾ã™ã€‚<br>
ãã®å¾Œã€MDBT50Q Dongleï¼ˆï¼æ–°ãŸã«è¿½åŠ ã•ã‚ŒãŸã‚µãƒãƒ¼ãƒˆå¯¾è±¡ãƒ‡ãƒã‚¤ã‚¹ï¼‰ã‚’ã€PCã®USBãƒãƒ¼ãƒˆã«æ¥ç¶šã—ã¾ã™ã€‚

macOSã®ã€Œã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ã€ã‚¢ãƒ—ãƒªã‚’å®Ÿè¡Œã—ã€èªè­˜ãƒ»æ¥ç¶šã•ã‚Œã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚<br>
ä¸‹å›³ã®ã‚ˆã†ã«ã€è£½å“IDï¼`0x0001`ã€è£½é€ å…ƒIDï¼`0xF055`ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°OKã§ã™ã€‚

<img src="assets03/0004.jpg" width="500">

ä»¥ä¸Šã§å‹•ä½œç¢ºèªã¯å®Œäº†ã§ã™ã€‚

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®ä½œæˆ

ä»–ã®macOSã‚’æ­è¼‰ã—ãŸPCã«ã€ä¸Šè¨˜æ‰‹é †ã§ä½œæˆã—ãŸCCIDãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ï¼ˆå†é ’å¸ƒç”¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰ã‚’ä½œæˆã—ã¾ã™ã€‚

#### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ä½œæˆç”¨åª’ä½“ã®é…ç½®

`${HOME}/GitHub/onecard-fido/CCID/macOSDriver`ã«ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã—ã¾ã™ã€‚

ã¾ãšã¯ã€ã“ã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ç›´ä¸‹ã«`CCIDDriver.plist`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®å†…å®¹ã§ç”Ÿæˆã—ã¾ã™ã€‚

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<array>
	<dict>
		<key>BundleHasStrictIdentifier</key>
		<true/>
		<key>BundleIsRelocatable</key>
		<false/>
		<key>BundleIsVersionChecked</key>
		<false/>
		<key>BundleOverwriteAction</key>
		<string>upgrade</string>
		<key>RootRelativeBundlePath</key>
		<string>ifd-ccid.bundle</string>
	</dict>
</array>
</plist>
```

æ¬¡ã«ã€`bundle`ã¨ã„ã†ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ¼ã«ã€å‰è¿°ã®æ‰‹é †ã§ç”Ÿæˆã—ãŸãƒ‰ãƒ©ã‚¤ãƒãƒ¼`ifd-ccid.bundle`ã‚’ã€æ¨©é™ã‚’å¤‰ãˆãšã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚<br>
ä»¥ä¸‹ã¯å®Ÿè¡Œä¾‹ã«ãªã‚Šã¾ã™ã€‚

```
bash-3.2$ cp -prv /usr/local/libexec/SmartCardServices/drivers/ifd-ccid.bundle ${HOME}/GitHub/onecard-fido/CCID/macOSDriver/bundle
/usr/local/libexec/SmartCardServices/drivers/ifd-ccid.bundle -> /Users/makmorit/GitHub/onecard-fido/CCID/macOSDriver/bundle/ifd-ccid.bundle
/usr/local/libexec/SmartCardServices/drivers/ifd-ccid.bundle/Contents -> /Users/makmorit/GitHub/onecard-fido/CCID/macOSDriver/bundle/ifd-ccid.bundle/Contents
/usr/local/libexec/SmartCardServices/drivers/ifd-ccid.bundle/Contents/MacOS -> /Users/makmorit/GitHub/onecard-fido/CCID/macOSDriver/bundle/ifd-ccid.bundle/Contents/MacOS
/usr/local/libexec/SmartCardServices/drivers/ifd-ccid.bundle/Contents/MacOS/libccid.dylib -> /Users/makmorit/GitHub/onecard-fido/CCID/macOSDriver/bundle/ifd-ccid.bundle/Contents/MacOS/libccid.dylib
/usr/local/libexec/SmartCardServices/drivers/ifd-ccid.bundle/Contents/Info.plist -> /Users/makmorit/GitHub/onecard-fido/CCID/macOSDriver/bundle/ifd-ccid.bundle/Contents/Info.plist
bash-3.2$
```

#### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®ä½œæˆ

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ä½œæˆã®ãŸã‚ã«å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒæƒã£ãŸã‚‰ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
cd ${HOME}/GitHub/onecard-fido/CCID/macOSDriver/
rm -rfv CCIDDriver.pkg
pkgbuild --root bundle --component-plist CCIDDriver.plist --identifier jp.co.diverta.CCIDDriver --version 1.5.1 --install-location /usr/local/libexec/SmartCardServices/drivers CCIDDriver.pkg
```

ä¸‹è¨˜ã¯å®Ÿè¡Œä¾‹ã«ãªã‚Šã¾ã™ã€‚<br>
`CCIDDriver.pkg`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆCCIDãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ï¼‰ãŒä½œæˆã•ã‚Œã¾ã™ã€‚<br>
ã“ã®`CCIDDriver.pkg`ã‚’ã€é©å®œã»ã‹ã®macOSç’°å¢ƒã«é…å¸ƒã—ã€CCIDãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

```
bash-3.2$ cd ${HOME}/GitHub/onecard-fido/CCID/macOSDriver/
bash-3.2$ rm -rfv CCIDDriver.pkg
CCIDDriver.pkg
bash-3.2$ pkgbuild --root bundle --component-plist CCIDDriver.plist --identifier jp.co.diverta.CCIDDriver --version 1.5.1 --install-location /usr/local/libexec/SmartCardServices/drivers CCIDDriver.pkg
pkgbuild: Reading components from CCIDDriver.plist
pkgbuild: Adding component at ifd-ccid.bundle
pkgbuild: Wrote package to CCIDDriver.pkg
bash-3.2$
bash-3.2$ ls -al *.pkg
-rw-r--r--  1 makmorit  staff  125513  1 16 13:04 CCIDDriver.pkg
bash-3.2$
```


ä»¥ä¸Šã§ã€CCIDãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ä½œæˆã¯å®Œäº†ã§ã™ã€‚
