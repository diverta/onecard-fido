# BLEペアリング手順

## 概要

[FIDO認証器管理ツール](README.md)を使用し、PCとFIDO認証器をBLEペアリングする手順について掲載しています。

#### 使用機材

本手順書では、FIDO認証器として、[MDBT50Q Dongle](../../FIDO2Device/MDBT50Q_Dongle/README.md)を使用するものといたします。

まずは、背面にあるボタン電池ケースに電池をセットし、BLEペリフェラル・モードで起動されていることをご確認ください。<br>
（MDBT50Q Dongleの青色LEDが点滅していることを確認します）

<img src="../../FIDO2Device/MDBT50Q_Dongle/pcb_rev2_1_2/assets/0004.jpg" width="400">

## ペアリングの実行

PCとFIDO認証器をBLEペアリングします。

#### ペアリング設定の事前削除

もし、PC側にペアリング相手のFIDO認証器のペアリング設定が存在する場合は、ペアリング実行前に必ず削除してください。

PCのBluetooth設定画面を開き、ペアリング設定を削除します。

<img src="assets06/0001.jpg" width="400">

確認ダイアログが表示されますので、続行するには「はい」をクリックします。

<img src="assets06/0002.jpg" width="400">

ペアリング相手のFIDO認証器のペアリング設定が削除されたことを確認します。

<img src="assets06/0003.jpg" width="400">

#### ペアリングモードに遷移

ペアリング相手のFIDO認証器を、ペアリングモードに遷移させます。<br>
MDBT50Q Dongleの場合は、基板上のボタンを３秒以上長押してから離すと、下図のように基板上の橙色LEDが点灯します。

<img src="../../FIDO2Device/MDBT50Q_Dongle/pcb_rev2_1_2/assets/0005.jpg" width="400">

これで、FIDO認証器がペアリングモードに遷移しました。

#### ペアリングの実行

管理ツールを起動し、画面の「ペアリング実行」ボタンをクリックします。

<img src="assets06/0004.jpg" width="400">

ペアリング実行画面がポップアップ表示されます。

[MDBT50Q Dongle](../../FIDO2Device/MDBT50Q_Dongle/README.md)（nRF52840基板）の場合、パスコード入力は不要です。<br>
パスコード入力欄は何も入力しないでください。<br>
nRF5340基板の場合のみ、半角数字６桁のパスコードを入力します。

ペアリング処理を開始するには「OK」ボタンをクリックします。

<img src="assets06/0025.jpg" width="400">

ペアリング処理が開始されますので、そのまま待ちます。

<img src="assets06/0005.jpg" width="400">

ペアリング処理が正常終了すると、下図のようなポップアップが表示され、処理が成功したことを知らせます。

<img src="assets06/0006.jpg" width="400">

#### BLE接続を確認

BLE PINGを実行し、PCとFIDO認証器がBLE接続できることを確認します。<br>

管理ツールのメニューから「Test > BLE > PINGテスト実行」を選択すると、BLE PING（BLE接続テスト）処理が開始されます。

<img src="assets06/0007.jpg" width="400">

BLE PING処理が正常終了すると、下図のようなポップアップが表示され、処理が成功したことを知らせます。

<img src="assets06/0008.jpg" width="400">

以上で、BLEペアリングの実行は完了となります。

## BLEペアリングの解除

PCとFIDO認証器のペアリングを解除することができます。<br>
ペアリング解除を実行するためには、USB接続が必要となります。

#### ペアリング解除の実行

管理ツールを起動し、PCのUSBポートにFIDO認証器を装着します。

<img src="assets/0020.jpg" width="400">

管理ツール画面下部のメッセージ欄に「USB HIDデバイスに接続されました。」と表示されることを確認したら、管理ツール画面の「ペアリング解除」ボタンをクリックします。

<img src="assets06/0009.jpg" width="400">

確認ダイアログが表示されます。<br>
処理を続行したい場合は「Yes」をクリックします。

<img src="assets06/0010.jpg" width="400">

ペアリング解除処理が正常終了すると、下図のようなポップアップが表示され、処理が成功したことを知らせます。

<img src="assets06/0011.jpg" width="400">

#### ペアリング設定の削除

ペアリング解除により、不要になったペアリング設定は、PCの環境設定から削除します。<br>
PCのBluetooth設定画面を開き、ペアリング設定を削除します。

<img src="assets06/0001.jpg" width="400">

確認ダイアログが表示されますので、続行するには「はい」をクリックします。

<img src="assets06/0002.jpg" width="400">

ペアリングを解除したFIDO認証器のペアリング設定が削除されたことを確認します。

<img src="assets06/0003.jpg" width="400">

以上で、BLEペアリングの解除は完了となります。
