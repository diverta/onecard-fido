# OpenPGP機能の各種設定手順

最終更新日：2023/4/13

## 概要

[FIDO認証器管理ツール](../../MaintenanceTool/dotNET/README.md)を使用して、[MDBT50Q Dongle](../../FIDO2Device/MDBT50Q_Dongle/README.md)に対し、OpenPGP機能の各種設定を行う手順を掲載します。

- PIN番号管理
  - PIN番号を変更
  - 管理用PIN番号を変更
  - PIN番号をリセット
  - リセットコードを変更
  - リセットコードでPIN番号をリセット
- 認証器のファームウェア再起動

## OpenPGP設定画面の表示

OpenPGP機能の設定は「OpenPGP設定画面」上で行います。

管理ツールを起動し、USBポートにMDBT50Q Dongleを装着します。<br>
管理ツール画面下部のメッセージ欄に「USB HIDデバイスに接続されました。」と表示されることを確認したら、管理ツール画面の「OpenPGP設定」ボタンをクリックします。

<img src="assets04/0005.jpg" width="400">

ホーム画面の上に、OpenPGP設定画面がポップアップ表示されます。

<img src="assets04/0006.jpg" width="400">

以後の設定作業は、すべてこの「OpenPGP設定画面」で実行します。

## PIN番号管理

OpenPGP機能で使用するPIN番号は、初期状態のままでも使用できますが、セキュリティー目的で適宜変更することが可能です。<br>
OpenPGP設定画面のタブ「PIN番号管理」で、PIN番号の変更ができます。

<img src="assets04/0026.jpg" width="300">

### PIN番号を変更

OpenPGP機能で使用するPIN番号は、初期状態では「123456」ですが、こちらを任意のPIN番号に変更することができます。

「PIN番号管理」タブのラジオボタン「PIN番号を変更」を選択します。<br>
すぐ下にある入力欄「現在のPIN番号」「新しいPIN番号」「新しいPIN番号（確認）」に、それぞれ値を入力したら「実行」ボタンをクリックします。

<img src="assets04/0027.jpg" width="300">

下記のような確認ダイアログが表示されますので、Yesボタンをクリックします。

<img src="assets04/0028.jpg" width="300">

PIN番号変更処理が実行されます。<br>
程なく、下図のようなメッセージがポップアップ表示され、処理が完了します。

<img src="assets04/0029.jpg" width="300">

これでPIN番号の変更は完了です。

### 管理用PIN番号を変更

OpenPGP機能で使用する管理用PIN番号は、初期状態では「12345678」ですが、こちらを任意の管理用PIN番号に変更することができます。

「PIN番号管理」タブのラジオボタン「管理用PIN番号を変更」を選択します。<br>
すぐ下にある入力欄「現在の管理用PIN番号」「新しい管理用PIN番号」「新しい管理用PIN番号（確認）」に、それぞれ値を入力したら「実行」ボタンをクリックします。

<img src="assets04/0030.jpg" width="300">

下記のような確認ダイアログが表示されますので、Yesボタンをクリックします。

<img src="assets04/0031.jpg" width="300">

管理用PIN番号変更処理が実行されます。<br>
程なく、下図のようなメッセージがポップアップ表示され、処理が完了します。

<img src="assets04/0032.jpg" width="300">

これで管理用PIN番号の変更は完了です。

### PIN番号をリセット

OpenPGP機能において、PIN番号を３回連続で間違えて指定した場合、認証がブロックされ、PIN番号が使えなくなってしまいます。<br>
「PIN番号のリセット」を実行すると、新しいPIN番号でOpenPGP機能が再び利用できるようになります。

「PIN番号管理」タブのラジオボタン「PIN番号をリセット」を選択します。<br>
すぐ下にある入力欄「現在の管理用PIN番号」「新しいPIN番号」「新しいPIN番号（確認）」に、それぞれ値を入力したら「実行」ボタンをクリックします。

<img src="assets04/0033.jpg" width="300">

下記のような確認ダイアログが表示されますので、Yesボタンをクリックします。

<img src="assets04/0034.jpg" width="300">

PIN番号リセット処理が実行されます。<br>
程なく、下図のようなメッセージがポップアップ表示され、処理が完了します。

<img src="assets04/0035.jpg" width="300">

これでPIN番号のリセットは完了です。

### リセットコードを変更

OpenPGP機能において、PIN番号を３回連続で間違えて指定した場合、認証がブロックされ、PIN番号が使えなくなってしまいます。<br>
「リセットコード」は、再び新しいPIN番号でOpenPGP機能が利用できるようにする（＝PIN番号をリセットする）時に使う認証用の番号です。

OpenPGP機能で使用するリセットコードは、初期状態では「12345678」ですが、こちらを任意のリセットコードに変更することができます。

「PIN番号管理」タブのラジオボタン「リセットコードを変更」を選択します。<br>
すぐ下にある入力欄「現在の管理用PIN番号」「新しいリセットコード」「新しいリセットコード（確認）」に、それぞれ値を入力したら「実行」ボタンをクリックします。

<img src="assets04/0036.jpg" width="300">

下記のような確認ダイアログが表示されますので、Yesボタンをクリックします。

<img src="assets04/0037.jpg" width="300">

リセットコード変更処理が実行されます。<br>
程なく、下図のようなメッセージがポップアップ表示され、処理が完了します。

<img src="assets04/0038.jpg" width="300">

これでリセットコードの変更は完了です。

### リセットコードでPIN番号をリセット

OpenPGP機能において、PIN番号を３回連続で間違えて指定した場合、認証がブロックされ、PIN番号が使えなくなってしまいます。<br>
「PIN番号のリセット」を実行すると、新しいPIN番号でOpenPGP機能が再び利用できるようになります。

「PIN番号管理」タブのラジオボタン「リセットコードでPIN番号をリセット」を選択します。<br>
すぐ下にある入力欄「現在のリセットコード」「新しいPIN番号」「新しいPIN番号（確認）」に、それぞれ値を入力したら「実行」ボタンをクリックします。

<img src="assets04/0039.jpg" width="300">

下記のような確認ダイアログが表示されますので、Yesボタンをクリックします。

<img src="assets04/0040.jpg" width="300">

PIN番号リセット処理が実行されます。<br>
程なく、下図のようなメッセージがポップアップ表示され、処理が完了します。

<img src="assets04/0041.jpg" width="300">

これで、リセットコードによるPIN番号のリセットは完了です。

## 認証器のファームウェア再起動

前述までの各機能を実行時、下図のようなエラーメッセージが表示されることがあります。

<img src="assets04/0023.jpg" width="300">

この場合は、認証器のリセットをお試しいただくことにより、認証器の再装着が不要となる場合があります。<br>
画面下部のボタン「認証器のリセット」をクリックします。

<img src="assets04/0024.jpg" width="300">

認証器がUSBに装着されたまま、認証器のファームウェアが再起動します。<br>
程なく、下図のようなメッセージがポップアップ表示され、処理が完了します。

<img src="assets04/0025.jpg" width="300">

万が一、上記手順でも解消しない場合は、一旦MDBT50Q DongleをPCのUSBポートから取り出し、再度装着した後、処理を再試行していただけますようお願いします。
