# nRF52840 ブートローダーアプリケーション

## 簡易USBブートローダー

`open_bootloader`は、簡易USBブートローダーです。

Nordic社から提供されているサンプル「[Open Bootloader with DFU](https://infocenter.nordicsemi.com/topic/com.nordic.infocenter.sdk5.v15.2.0/ble_sdk_app_open_bootloader.html)」を小修正し、[MDBT50Q Dongle](../../../FIDO2Device/MDBT50Q_Dongle/README.md)で利用できるようにしたものです。

### ファームウェア

ファームウェアは２点で構成されます。

- ディレクトリー：[/nRF5_SDK_v15.3.0/firmwares/open_bootloader/](../../../nRF5_SDK_v15.3.0/firmwares/open_bootloader/)

- ファイル：`mbr_nrf52_2.4.1_mbr.hex`、`nrf52840_xxaa.hex`<br>
`mbr_nrf52_2.4.1_mbr.hex`は、Nordic社から提供されているものをそのまま使用します。<br>
`nrf52840_xxaa.hex`は、後述「ファームウェア作成手順」により作成したものを使用します。


### [ファームウェア作成手順](NETBEANSPROJ.md)

NetBeansとARM GCC、nRF5 SDKを使用し、簡易USBブートローダーを作成する手順を記載しています。

### [ファームウェア書込手順](JLINKSWDPROG.md)

MDBT50Q Dongleに、簡易USBブートローダーをJ-Link経由で書込みする手順を記載しています。

## 公開鍵ファイル

`dfu_public_key.c`は、Nordic社提供サンプルから修正しております。<br>
下記のようなコマンドを実行して作成されたものです。

```
MacBookPro-makmorit-jp:~ makmorit$ nrfutil keys generate private.pem
Generated private key and stored it in: private.pem
MacBookPro-makmorit-jp:~ makmorit$ nrfutil keys display --key pk --format code private.pem

/* This file was automatically generated by nrfutil on 2019-09-24 (YY-MM-DD) at 15:09:06 */

#include "stdint.h"
#include "compiler_abstraction.h"

/** @brief Public key used to verify DFU images */
__ALIGN(4) const uint8_t pk[64] =
{
    0x1b, 0x4a, 0x42, 0x57, 0x1c, 0xe7, 0xa2, 0x67, 0x36, 0x7b, 0x6a, 0x87, 0x84, 0xe4, 0x10, 0x40, 0x1b, 0xa8, 0xcc, 0xca, 0x37, 0xe2, 0x97, 0x37, 0x3e, 0x2d, 0x75, 0xb3, 0xc9, 0x87, 0x05, 0xee,
    0xeb, 0x91, 0x9b, 0x0f, 0xb3, 0xe1, 0x07, 0xa9, 0x64, 0x95, 0xd6, 0x82, 0x59, 0xc2, 0x02, 0x80, 0xad, 0x41, 0x35, 0x5e, 0xbc, 0x85, 0x80, 0xcc, 0x27, 0xde, 0x8f, 0x7c, 0x2b, 0xb3, 0xd1, 0x45
};

MacBookPro-makmorit-jp:~ makmorit$
```

ご参考：[GitHub - pc-nrfutil](https://github.com/NordicSemiconductor/pc-nrfutil/blob/master/README.md)
