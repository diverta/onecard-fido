# nRF5340 Lockアプリについて

nRF5340を使用し、Threadネットワーク内で稼働するLock（施錠）アプリを実装するサンプルです。

## nRF Connect Lockサンプルアプリ

nRF Connect Lockサンプルアプリ（CHIPデバイス）は、1本の基本的なボルトでドア施錠するデバイス（CHIPコントローラーデバイス）をリモート制御するサンプルになります。

ボタンを使用してロックとデバイス状態の変更をテストし、LEDによりこれらの変更状態を表示します。<br>
このサンプルアプリは、独自アプリケーションを作成するためのリファレンスとして使用できます。

このサンプルアプリは、CHIPとNordicSemiconductorのnRFConnect SDKをベースとしています。<br>
低電力の802.15.4 Threadネットワークを介したドアロックのリモートアクセス／制御をサポートしています。<br>
（訳者注：<b>Thread</b> ＝ IoT無線規格のひとつ）

このサンプルアプリは、CHIPアクセサリとして動作します。<br>
このサンプルアプリデバイスは、既存のCHIPネットワークとペアリングでき、そのネットワークを通じて制御できます。

#### 概要

このサンプルアプリは、Nordic SemiconductorのnRF Connect SDKとZephyr RTOSをベースとしたnRF Connect CHIPプラットフォームで実行されます。<br>
CHIPプラットフォームの構造と依存関係の詳細については、nRF Connect CHIPプラットフォームの概要をご覧ください。<br>
https://github.com/project-chip/connectedhomeip/blob/master/docs/guides/nrfconnect_platform_overview.md

Lockアプリケーションを実行するCHIPデバイスは、Threadプロトコルを介してCHIPコントローラーデバイスによって制御されます。<br>
デフォルトでは、CHIPデバイスではThreadが稼働していない（無効になっている）ため、CHIPコントローラーとペアリングして、CHIPに関する構成を取得する必要があります。<br>
完全な通信を確立する前に必要な、いくつかのアクションを以下に説明します。

このサンプルアプリには、テストモードも付属しており、ボタンを手動で押すことでデフォルト設定でThreadを開始できます。<br>
ただし、このモードは、デバイスがCHIPコントローラーおよび他デバイスと通信できることを保証するものではありません。

#### BLEアドバタイズ

このサンプルアプリでは、デバイスをCHIPネットワークにコミッショニングするには、BLEを介してデバイスを検出できる必要があります。<br>
セキュリティ上の理由から、ボタン4を押してデバイスの電源を入れた後、BLEアドバタイズを手動で開始する必要があります。

#### BLEランデブー

この例では、コミッショニング手順（ランデブーと呼ばれる）は、CHIPデバイスとCHIPコントローラーの間でBLEを介して実行されます。<br>
（訳者注：BLE NFCペアリングの転用）

ここで、CHIPコントローラーはコミッショナーの役割を果たします。

ランデブーを開始するには、コントローラーはCHIPデバイスからコミッショニング情報を取得する必要があります。<br>
コミッショニング情報のデータ内容は、QRコードを使用してエンコードされ、NFCタグエミュレーションを使用し共有されます。<br>
（訳者注：サンプルアプリのプログラムは、データ内容をUARTコンソールにも出力するようです）

セキュリティ上の理由から、ボタン4を押してデバイスの電源を入れた後、手動でNFCタグエミュレーションを開始する必要があります。

#### Threadプロビジョニング

ランデブー処理の最終工程として、プロビジョニング操作では、CHIPコントローラーからCHIPデバイスへのThreadネットワーククレデンシャルの送信が行われます。<br>
その結果、デバイスはThreadネットワークに参加し、ネットワーク内の他のThreadデバイスと通信できるようになります。

## ご参考：DFUについて

このサンプルアプリは、セキュアブートローダーを使用し、BLEを使用して無線DFUを実行するために使用するように構成できます。

#### DFU
（`Device Firmware Upgrade`）

このサンプルアプリでは、無線DFU機能を有効にすることができます。<br>
DFU処理では、新しいファームウェアイメージをホストしているデバイスが、BLEトランスポートと`Simple Management Protocol`を使用し、ファームウェアイメージをCHIPデバイスに送信します。<br>
次に、MCUbootブートローダーという仕組みが、古いファームウェアイメージを新しいファームウェアイメージに置き換えます。

#### ブートローダー

MCUbootは、異なるバージョンのファームウェアイメージを交換し、デバイスのDFU処理で使用できる適切なバイナリーを生成するために使用される安全なブートローダーです。

ブートローダーには、DFU中にアプリケーションイメージを置き換えるためのフラッシュメモリ領域が必要です。<br>
Nordicデバイスは、この目的のために外部メモリチップを使用します。<br>
メモリチップは、QSPIバスを介してマイクロコントローラと通信します。

このサンプルアプリでMCUbootとフラッシュの設定を変更する方法については、`Building with Device FirmwareUpgrade`のサポートセクションを参照してください。

#### SMP
（`Simple Management Protocol`）

SMPは、アプリケーションイメージ管理を含むデバイス管理の目的で使用される基本的な転送方法です。<br>
SMPは、Bluetooth LE、UDP、シリアルUSB / UARTなどのさまざまなトランスポートの使用をサポートしています。<br>
このサンプルアプリでは、CHIPデバイスはSMPサーバーを実行し、BLEトランスポートを使用してアプリケーション更新イメージをダウンロードします。<br>
このサンプルアプリでSMPを有効にし、DFUの目的で使用する方法については「DFUを使用したビルドのサポート」セクションを参照してください。
